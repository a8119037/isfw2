<!DOCTYPE html>

<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

        <script type="text/javascript" src="lib/jquery.min.js"></script>
        <script type="text/javascript" src="lib/osql.js"></script>

        <script>
            osql.requireLogin();

            $().ready(function () {
                init();
                attendanceInfo();
            });
            function init() {
                var name = sessionStorage.getItem("username");
                document.getElementById("welcome").innerHTML = "ようこそ" + name + "さん";
            }

            // 出席情報を表示
            async function attendanceInfo() {
                const userId = sessionStorage.getItem("userid");
                // User_Sheetから最新の出席情報をとってくる
                const sql = `select * from User_Sheet where user_id = "${userId}" order by created_at desc;`;
                const objects = await osql.connect(sql);
                console.log(objects[0]);

                document.getElementById(
                    "attendanceInfo"
                ).outerHTML = `最終登録: ${objects[0].created_at}, 座席${objects[0].sheet_id}`;

                // attendance.htmlへのリンク
                if (objects[0].is_attend == 0) {
                    document.getElementById(
                        "attendanceLink"
                    ).innerHTML = `<a href="register/attendance.html">出席登録へ</a>`;
                } else if (objects[0].is_attend == 1) {
                    document.getElementById(
                        "attendanceLink"
                    ).innerHTML = `<a href="register/attendance.html?state=leave">出席登録へ</a>`;
                }
            }
        </script>
    </head>

    <body>
        <h1>ユーザトップ</h1>
        <p id="welcome">ようこそxxさん</p>
        <hr />
        <span id="attendanceLink">出席登録へ</span>
        <span id="attendanceInfo"></span>
    </body>
</html>
